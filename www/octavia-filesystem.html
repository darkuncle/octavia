<html>

<head>
<style>
body {
      line-height: 150%;
      background: #eee;
      margin-top: 1in;
      margin-left: 1in;
      margin-right: 1in;
}
</style>
<title>Octavia: A Secure Decentralized Filesystem</title>
</head>

<body>

<h1>Octavia: A Secure Decentralized Filesystem</h1>

<p><em>By Chris Palmer &lt;chris@noncombatant.org&gt;. Last updated 17 Feb
2009.</em></p>

<h2>Abstract</h2>

<p>Octavia is a secure, decentralized network filesystem. It offers data
confidentiality, data integrity, client and server authentication, simple
access control, redundancy, and the potential for relatively high
performance. Servers can set policy independently of clients; clients may
transparently make use of servers with widely varying policies.</p>


<div style="line-height: 120%"><ol>
<li><a href="#sec:introduction">Introduction</a></li>
<li><a href="#sec:prior-work">Prior Work</a></li>
<li><a href="#sec:message-types">Message Types</a></li>
<li><a href="#sec:security-guarantees">Security Guarantees</a></li>
<li><a href="#sec:security-concerns">Security Concerns</a></li>
<li><a href="#sec:directory-file-descriptors">Directory and File Descriptors</a></li>
<li><a href="#sec:deployment-scenarios">Deployment Scenarios</a></li>
<li><a href="#sec:acknowledgements">Acknowledgements</a></li>
<li><a href="#sec:footnotes">Footnotes</a></li>
</ol></small></div>

<hr size="1" noshade />


<a name="sec:introduction"></a>
<h2>Introduction</h2>


<a name="sec:prior-work"></a>
<h2>Prior Work</h2>

<p>Venti, the Plan 9 distributed filesystem (block IDs as hashes). Tahoe,
other other other thingies. TODO cites.</p>


<a name="sec:message-types"></a>
<h2>Message Types</h2>

<p>In the following equations, # indicates string concatenation.</p>

<p>The <var>block</var><var><sub><small>ID</small></sub></var> (Equation 1)
is a globally unique identifier for a <var>block</var> of data, generated
using a cryptographic hash function. We re-hash the output of the hash
function (Equation 2) in order to work around a problem of iterative block
hashes: that <var>hash</var>(<var>M</var>) is a precursor to
<var>hash</var>(<var>M</var>
# <var>N</var>). TODO cite Ferguson, others.  Mention the other solution and
talk about why we use this one. Or should we change.</p>

<blockquote>

<strong>Equation 1.</strong>

<var>block</var><var><sub><small>ID</small></sub></var> = <var>hash</var> (
<var>block</var><var><sub><small>size</small></sub></var> # <var>block</var>
)

</blockquote>

<blockquote>

<strong>Equation 2.</strong>

<var>hash</var> ( <var>data</var> ) = SHA-256 ( SHA-256 ( <var>data</var> )
)

</blockquote>

<p>Storage Requests and Responses require client and server authentication,
as well as block integrity. To achieve this, Octavia uses a message
authentication code (MAC), specifically
HMAC<sub><small>SHA-256</small></sub> (Equation 3). By signing the
<var>nonce</var>, <var>block</var><sub><small><var>size</var></small></sub>,
and <var>block</var> (Equation 4), we get the
<var>block</var><sub><small><var>signature</var></small></sub>. This is a
globally unique identifier that could only have been generated by an entity
holding the signing <var>key</var>, and thus authenticates both the data and
the key holder.</p>

<blockquote>

<strong>Equation 3.</strong>

<var>sign</var> ( <var>data</var> ) = HMAC<sub><small>SHA-256</small></sub>
( <var>key</var>, <var>data</var> )

</blockquote>

<blockquote>

<strong>Equation 4.</strong>

<var>block</var><sub><small><var>signature</var></small></sub> =
<var>sign</var> ( <var>nonce</var> #
<var>block</var><sub><small><var>size</var></small></sub>
# <var>block</var> )

</blockquote>

<h3>Constants</h3>

<p>This document describes protocol version 0. There are four message types
(although see <a href="#sec:future-messages">Possible Future Message
Types</a>): Retrieval Request = 0, Retrieval Response = 1, Storage Request =
2, and Storage Response = 3.</p>

<a name="sec:RetReq"></a>
<h3>Retrieval Request (Ret Req)</h3>

<p>Clients send Retrieval Request messages (Figure 1) to servers when they
want to read a block of data. They specify the protocol version,
<var>messageType</var> = 0, and the
<var>block</var><sub><small><var>ID</var></small></sub>.</p>

<blockquote>
<strong>Figure 1: Retrieval Request message format.</strong>

<br />

<pre>
 0                 16              31
+--------+--------+--------+--------+
|version | type=0 | reserved        |
+--------+--------+--------+--------+
| blockID...                        |
+--------+--------+--------+--------+
| blockID...                        |
+--------+--------+--------+--------+
| blockID...                        |
+--------+--------+--------+--------+
| blockID...                        |
+--------+--------+--------+--------+
| blockID...                        |
+--------+--------+--------+--------+
| blockID                           |
+--------+--------+--------+--------+
</pre>

</blockquote>

<a name="sec:RetRes"></a>
<h3>Retrieval Response (Ret Res)</h3>

<blockquote>
<strong>Figure 2: The Retrieval Response message format.</strong>

<br />

<pre>
 0                 16              31
+--------+--------+--------+--------+
|version | type=1 | block...        |
+--------+--------+--------+--------+
| block...                          |
+--------+-------///-------+--------+
| block                             |
+--------+--------+--------+--------+
</pre>

</blockquote>

<a name="sec:StoReq"></a>
<h3>Storage Request (Sto Req)</h3>

<blockquote>
<strong>Figure 3: The Storage Request message format.</strong>

<br />

<pre>
 0                 16              31
+--------+--------+--------+--------+
|version | type=2 | reserved        |
+--------+--------+--------+--------+
| nonce...                          |
+--------+--------+--------+--------+
| nonce...                          |
+--------+--------+--------+--------+
| nonce...                          |
+--------+--------+--------+--------+
| nonce                             |
+--------+--------+--------+--------+
| signature...                      |
+--------+--------+--------+--------+
| signature...                      |
+--------+--------+--------+--------+
| signature...                      |
+--------+--------+--------+--------+
| signature...                      |
+--------+--------+--------+--------+
| signature...                      |
+--------+--------+--------+--------+
| signature                         |
+--------+--------+--------+--------+
| block...                          |
+--------+-------///-------+--------+
| block                             |
+--------+--------+--------+--------+
</pre>

</blockquote>

<a name="sec:StoRes"></a>
<h3>Storage Response (Sto Res)</h3>

<blockquote>
<strong>Figure 4: The Storage Response message format.</strong>

<br />

<pre>
 0                 16              31
+--------+--------+--------+--------+
|        |        |        |        |
+--------+--------+--------+--------+
|        |        |        |        |
+--------+--------+--------+--------+
|        |        |        |        |
+--------+--------+--------+--------+
|        |        |        |        |
+--------+--------+--------+--------+
|        |        |        |        |
+--------+--------+--------+--------+
|        |        |        |        |
+--------+--------+--------+--------+
</pre>

</blockquote>

<a name="sec:future-messages"></a>
<h3>Possible Future Message Types</h3>

<p>Revoke Request and Revoke Response, to request that a server delete
blocks with a given <var>block</var><sub><small><var>ID</var></small></sub>.
Servers MAY set an arbitrary policy for block deletion or non-deletion in
any case; servers SHOULD honor Revoke Requests when feasible.</p>


<a name="sec:security-guarantees"></a>
<h2>Security Guarantees</h2>

<p>Data integrity. Client need not care who sends a Retrieval Response, as
long as the integrity check passes. Protection against active network
attackers.</p>

<p>Data confidentiality. Server can re-store blocks to improve its apparent
reliability, without violating confidentiality. Confidentiality against
eavesdroppers and unauthorized clients and users (access control).</p>

<p>Client authentication in Storage Request.</p>

<p>Server authentcation in Storage Response.</p>

<p>Replay of Storage Responses prevented with nonce.</p>

<p>Promise of storage, signed by server with trusted key.</p>

<p>Servers can enforce quotas or access control with Storage Requests, since
they know the identity of the client.</p>


<a name="sec:security-concerns"></a>
<h2>Security Concerns</h2>

<p>Strength of hash function.</p>

<p>Servers that lie in Storage Responses. Solution: clients MAY, and
probably SHOULD, store their blocks with multiple servers. Sybil attack?</p>

<p>No defense against traffic analysis. Paranoid users may use an
anonymizing transport layer such as Tor.</p>


<a name="sec:directory-file-descriptors"></a>
<h2>Directory and File Descriptors</h2>


<a name="sec:deployment-scenarios"></a>
<h2>Deployment Scenarios</h2>


<a name="sec:acknowledgements"></a>
<h2>Acknowledgements</h2>

<p>Jesse Burns for discussion. Alex Vidergar for discussion and for pointing
out the threat of replayed Storage Responses unless there is a nonce.
Ferguson and Schneier for handy tips. The late, great Octavia Butler for
economy of mechanism and insight.</p>


<hr size="1" noshade />

<a name="sec:footnotes"></a>
<h2>Footnotes</h2>

<a href="http://creativecommons.org/licenses/by-sa/3.0/"><img
src="cc-by-sa.png" alt="CC Attribution-ShareAlike" /></a>

</body>

</html>

